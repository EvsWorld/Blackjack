<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  
  <style>
        .game
        {
            width: 720px;
            border: solid 1px #ddd;
            margin: 0 auto;
            padding: 30px;
        }

        .card{
            width: 70px;
            height: 100px;
            padding: 10px;
            border: solid 1px #808080;
            background-color: white;
            display: inline-block;
            border-radius: 10px;
            font-size: 8pt;
            text-align: center;
            margin: 3px;
        }

        .players{
            float:left;
            width: 500px;
        }

        .player{
            width: 40%;
            border: solid 2px #ccc;
            border-radius: 10px;
            padding: 10px;
            display: inline-block;
            margin:1%;
            vertical-align: top;
        }

        .player.active{
            border: solid 2px #1caff6;
        }

        .points{
            text-align: center;
            font-size: 20pt;
            font-weight: bold;
            margin: 10px;
        }

        .deck{
            float:right;
            width: 200px;
        }
    </style>
    
  <div id="dummy"></div>
  <div class="game">
        <h1>Blackjack</h1>
        <input type="button" class="btn" value="start" onclick="startGame()" />
        <!-- <input type="button" class="btn" value="hit me" onclick="hitMe()" />
        <input type="button" class="btn" value="stay" onclick="stay()" /> -->

        <div id="players" class="players">
          
        </div>

        <div id="deck" class="deck">
          <h3>Player Hand</h3>
          <div id="player-hand"></div>
          
          <h3>Dealer Hand</h3>
          <div id="dealer-hand"></div>
          
            <!-- <div class="card" id="deckcount">52</div> -->
            <div class="status" id="status"></div>
        </div>

        <div class="clear"></div>
    </div>

  <script>
    "use strict";  

  
    // card constructor again here, use private variables
    function Card(n, s) {
      var number = n;
      var suit = s;
      //getters
      this.getNumber = function() { 
        return number;
      };
      this.getSuit = function() { 
        return suit;
      };
      this.getValue = function() {
        if ( number === 11 || number === 12 || number === 13 ) {
          console.log("Card function got an 11, 12, or 13 and returned 10");
          return 10;
        } else if ( number === 1 ) { //TODO: Handle hard hands(how to value ace when it could cause you to bust)
          console.log("Card function got a 1 and returned 11");
          return 11;
        } else {
          return number;
        }
      };
      //       ([11,12,13].includes(number)) ? 10 // If true return 10 
      //       : (number === 1) ? 11          // Else if number==1, return 11 
      //                            : number  // Else return number
      // );     
    }

    // Generates two random numbers 1-13 and 1-4. return new Card object 
    function deal() {
      var randNum = Math.floor(Math.random() * 13) + 1; 
      var randSuit = Math.floor(Math.random() * 4) + 1;
      // console.log("the original random number is " + randNum);
      return new Card(randNum, randSuit);
    };

    // examples of the deal function in action
    // var card1 = deal();
    // var card2 = deal();

    function Hand() {
      // getValue is being called like a method of deal b/c deal() returns (creates) an object that the contains the getValue method (This is a closure)
      var score = 0;
      var playerDeck = new Array();  // Starts each player with no cards
      // FIlls up a "shoe" with 9 completely random hards.
      var shoe = [deal(), deal(), deal(), deal(), deal(), deal(), deal(), deal(), deal() ]     
      // var card1 = deal();
      // var card2 = deal();
      // var card3 = deal();
      // var card4 = deal();
      // var card5 = deal();
      // var card6 = deal();
      // var card7 = deal();
      // var card8 = deal();
      
      // deals random card and adds value to the hands score
      this.setHit = function() {
        playerDeck.push(shoe.pop());
          // gets game value of recently pushed card (from end of playerDeck)
          score += playerDeck[playerDeck.length-1].getValue()
          // for (let card of playerDeck) {
          //   score += card.getValue()
      };
      this.getScore = function() {
        return score;
      }; 
      this.getPlayerDeck = function() {
        return playerDeck;
      };
      this.getShoe = function() {
        return shoe;
      };  
    }
    
    // Hand.prototype = {
    //   get getScore() {
    //     return score;
    //   }
    // }
          
    function checkWhoHasHighScore(myScore, dScore) {
      checkForBust();
      if (myScore === dScore) {
        console.log("The game was a draw");
        console.log("My score is " + myHand.getScore() + ", " + " and the dealer's score is: " + dealerHand.getScore() );
        askToPlayAgain()
      } else if (myScore > dScore && myScore <= 21 ) {
        console.log("I won because I have the high score. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain()
      } else if ( dScore > myScore && dScore <= 21 ){
        console.log("The dealer won because he has the high score. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain()
      } 
    }        
         
    function checkForBlackjackOrBust(myScore, dScore) {
      if (myScore === 21 && dScore === 21) {
        console.log("The game was a draw.")
        console.log("My score is " + myHand.getScore() + ", " + " and the dealer's score is: " + dealerHand.getScore() );
        askToPlayAgain();
      } else if (myScore === 21 || dScore > 21) {
        console.log( "I won. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain();
        
      } else if ( dScore === 21 || myScore > 21 ) {
        console.log("The dealer won. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain();
        
      } else { return true; }
    }
    function checkForBust(myScore, dScore) {
      if ( dScore > 21) {
        console.log( "I won. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain();
        
      } else if ( myScore > 21 ) {
        console.log("The dealer won. My score is " + myScore + " and the dealer's score is " + dScore);
        askToPlayAgain();
        
      } else { return true; }
    }
    
    function askToPlayAgain() {
      //TODO Validate response
      var playerResponseToPlay = prompt("If you want to play again, enter 'y', if not enter 'n'.");
      while (!(['y','n'].includes(playerResponseToPlay))) {
         playerResponseToPlay = prompt("Not a valid response. Press 'y' to play or 'n' to stop.");
       }
      if (playerResponseToPlay === 'y' ) { 
        startGame(); 
      } else if (playerResponseToPlay === 'n' ) { 
         playerResponseToPlay = false;
      }
      return playerResponseToPlay;
      // I wanted to do this with ternaries
      // (playerResponseToPlay === 'y') ? 
      //   (startGame() : 
      //   (playerResponseToPlay==='n') ? break )
    }
    
    function promptUser() {
      var playerResponse = prompt("Press 'h' to hit or 's' to stand.");
      // Validate user response
      while (!(['s','h'].includes(playerResponse))) {
         playerResponse = prompt("Not a valid response. Press 'h' to hit or 's' to stand.");
      }
      return playerResponse;
    }

    // TODO: Render Card function. Use switch statement that takes current card as argument, then was switches for all 13 possible cards, or all 52 to make sure it's totally random. But it wouldnt affect the game. 
    
    // accepts aplicable deck and desired target id (one for me and one for dealer). This funtion will render each players' hand each time it is called.
    function showCardsInDeck(deck, player) {
      // clear html for player
      document.getElementById(player).innerHTML = "";
      //TODO: Make array of card images. 
       let imgArray = [ ['s01.bmp', 'c01.bmp', 'h01.bmp', 'd01.bmp'], ['s02.bmp', 'c02.bmp', 'h02.bmp', 'd02.bmp'], ['s03.bmp', 'c03.bmp', 'h03.bmp', 'd03.bmp'], ['s04.bmp', 'c04.bmp', 'h04.bmp', 'd04.bmp'], ['s05.bmp', 'c05.bmp', 'h05.bmp', 'd05.bmp'], ['s06.bmp', 'c06.bmp', 'h06.bmp', 'd06.bmp'], ['s07.bmp', 'c07.bmp', 'h07.bmp', 'd07.bmp'], ['s08.bmp', 'c08.bmp', 'h08.bmp', 'd08.bmp'], ['s09.bmp', 'c09.bmp', 'h09.bmp', 'd09.bmp'], ['s10.bmp', 'c10.bmp', 'h10.bmp', 'd10.bmp'], ['s11.bmp', 'c11.bmp', 'h11.bmp', 'd11.bmp'], ['s12.bmp', 'c12.bmp', 'h12.bmp', 'd12.bmp'], ['s13.bmp', 'c13.bmp', 'h13.bmp', 'd13.bmp'] ];
       
       // Testing the concept of getting random pics
       // let imgArray = [[1, 2, 3, 4], [1, 2, 3, 4], [1, 2, 3, 4]]
      
      for (let card in deck) {
        // Example for to return random element from array
        // var item = items[Math.floor(Math.random()*items.length)];
        console.log( "Number of card: " + card + " is: " + deck[card].getNumber() ); 
        console.log( "Suit of card: " + card + " is: " + deck[card].getSuit() );
        let elem;
        switch( deck[card].getNumber() ) {
          case 1:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let aceArray = imgArray[0];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = aceArray[Math.floor(Math.random()*aceArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 2:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let twoArray = imgArray[1];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = twoArray[Math.floor(Math.random()*twoArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 3:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let threeArray = imgArray[2];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = threeArray[Math.floor(Math.random()*threeArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 4:
            elem = document.createElement("img");
            // elem.src = 'images/three.jpg';
            let fourArray = imgArray[3];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = fourArray[Math.floor(Math.random()*fourArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 5:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let fiveArray = imgArray[4];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = fiveArray[Math.floor(Math.random()*fiveArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 6:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let sixArray = imgArray[5];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = sixArray[Math.floor(Math.random()*sixArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 7:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let sevenArray = imgArray[6];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = sevenArray[Math.floor(Math.random()*sevenArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 8:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let eightArray = imgArray[7];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = eightArray[Math.floor(Math.random()*eightArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 9:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let nineArray = imgArray[8];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = nineArray[Math.floor(Math.random()*nineArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 10:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let tenArray = imgArray[9];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = tenArray[Math.floor(Math.random()*tenArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 11:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let jokerArray = imgArray[10];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = jokerArray[Math.floor(Math.random()*jokerArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 12:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let queenArray = imgArray[11];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = queenArray[Math.floor(Math.random()*queenArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
          case 13:
            elem = document.createElement("img");
            // elem.src = 'images/ace.jpg';
            let kingArray = imgArray[12];  // array of aces
            // defines as img source an ace card of random suit
            elem.src = kingArray[Math.floor(Math.random()*kingArray.length)];
            document.getElementById(player).appendChild(elem);  
            break;
        }
      }
  }
    function startGame() {
      console.log("Starting a new game!");
      // the first card is dealt to both players.
      // How can I avoid all these different variables that refer to the same objects? Can I use the "spread opperator?"
      var myHand = new Hand();
      var dealerHand = new Hand();
      // var myHand.getScore() = myHand.getScore();
      // var dealerHand.getScore() = dealerHand.getScore()
      myHand.setHit()     // I get my first card 
      myHand.setHit()     // I get my second card
      dealerHand.setHit()     // The dealer gets his first card 
      // TODO: render my starting two cards and dealers first two cards with one face down.
     showCardsInDeck( myHand.getPlayerDeck(), 'player-hand' );
     showCardsInDeck( dealerHand.getPlayerDeck(), 'dealer-hand' );
    
      // At the start of the game, only tell the dealers first card
      console.log("My starting hand score is " + myHand.getScore() + ", " + " and the dealer's first card is: " + dealerHand.getScore() );
          
      
      dealerHand.setHit(); // Now give the dealer his 2nd card
      
      var playerResponse = promptUser();
      // promptUser();  // Not sure if playerResonse will be available
      
      // Should only enter this loop if user responds with 'h'.
      while (playerResponse === 'h' && myHand.getScore() != 21) {
        myHand.setHit();
        console.log( "I just hit");
        showCardsInDeck( myHand.getPlayerDeck(), 'player-hand' );
        showCardsInDeck( dealerHand.getPlayerDeck(), 'dealer-hand' );
        console.log("My score after the hit is " + myHand.getScore() + ", " + " and the dealer's real score is: " + dealerHand.getScore() );
        //TODO: Render new card for player
        checkForBust(myHand.getScore(), dealerHand.getScore());
        showCardsInDeck( myHand.getPlayerDeck(), 'player-hand' );
        showCardsInDeck( dealerHand.getPlayerDeck(), 'dealer-hand' );
        if (myHand.getScore() != 21) { 
          playerResponse = prompt("Press 'h' to hit or 's' to stand.") 
        };
      }
      if (playerResponse === 's') {
        while (dealerHand.getScore() <= 17 ) {
          dealerHand.setHit();
          console.log("The dealer just hit");
          showCardsInDeck( myHand.getPlayerDeck(), 'player-hand' );
          showCardsInDeck( dealerHand.getPlayerDeck(), 'dealer-hand' );
          checkForBlackjackOrBust(myHand.getScore(), dealerHand.getScore());
        }
        checkWhoHasHighScore(myHand.getScore(), dealerHand.getScore());   
        if ( playerResponseToPlay === 'n') { return;}
      }
    }
    
    
    // document.getElementById("dummy").innerHTML = "you said " + playerResponse;
  </script>



</body>

</html>